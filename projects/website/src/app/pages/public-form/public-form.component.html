<div class="form-container">
  @if (formData && !isSubmitted) {
    <header>
      <h1>{{ formData.title }}</h1>
      @if (formData.description) {
        <p>{{ formData.description }}</p>
      }
    </header>

    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      @for (field of formData.fields; track field.name) {
        <div class="form-field-wrapper">

          @switch (field.type) {
            @case ('string') {
              <mat-form-field appearance="outline">
                <mat-label>{{ field.label }}</mat-label>
                <input matInput [formControlName]="field.name" [placeholder]="field.placeholder || ''">
              </mat-form-field>
            }
            @case ('email') {
              <mat-form-field appearance="outline">
                <mat-label>{{ field.label }}</mat-label>
                <input matInput type="email" [formControlName]="field.name" [placeholder]="field.placeholder || ''">
              </mat-form-field>
            }
            @case ('password') {
              <mat-form-field appearance="outline">
                <mat-label>{{ field.label }}</mat-label>
                <input matInput type="password" [formControlName]="field.name" [placeholder]="field.placeholder || ''">
              </mat-form-field>
            }
            @case ('textarea') {
              <mat-form-field appearance="outline">
                <mat-label>{{ field.label }}</mat-label>
                <textarea matInput [formControlName]="field.name" [placeholder]="field.placeholder || ''"></textarea>
              </mat-form-field>
            }
            @case ('number') {
              <mat-form-field appearance="outline">
                <mat-label>{{ field.label }}</mat-label>
                <input matInput type="number" [formControlName]="field.name" [placeholder]="field.placeholder || ''">
              </mat-form-field>
            }
            @case ('boolean') {
              <mat-slide-toggle [formControlName]="field.name">{{ field.label }}</mat-slide-toggle>
            }
            @case ('checkbox') {
              <mat-checkbox [formControlName]="field.name">{{ field.label }}</mat-checkbox>
            }
            @case ('hidden') {
              <input type="hidden" [formControlName]="field.name">
            }
            @case ('date') {
              <mat-form-field appearance="outline">
                <mat-label>{{ field.label }}</mat-label>
                <input matInput [matDatepicker]="picker" [formControlName]="field.name" [placeholder]="field.placeholder || ''">
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
            }
            @case ('dropdown') {
              <mat-form-field appearance="outline">
                <mat-label>{{ field.label }}</mat-label>
                <mat-select [formControlName]="field.name">
                  @for (option of field.options; track option.value) {
                    <mat-option [value]="option.value">{{ option.label }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            }
            @case ('radio-group') {
              <label class="radio-group-label">{{ field.label }}</label>
              <mat-radio-group [formControlName]="field.name" class="radio-group-options">
                @for (option of field.options; track option.value) {
                  <mat-radio-button [value]="option.value">{{ option.label }}</mat-radio-button>
                }
              </mat-radio-group>
            }
            @case ('file') {
              <label class="file-input-label">{{ field.label }}</label>
              <input type="file" [formControlName]="field.name">
            }
            @case ('custom-html') {
              <div [innerHTML]="field.htmlContent | safeHtml"></div>
            }
          }

          @if (form.controls[field.name].hasError('required')) {
            <mat-error class="mat-caption">This field is required.</mat-error>
          }
          @if (form.controls[field.name].hasError('email')) {
            <mat-error class="mat-caption">Please enter a valid email address.</mat-error>
          }
        </div>
      }

      <button mat-flat-button color="primary" type="submit">Submit</button>
    </form>
  } @else if (isSubmitted) {
    <div class="submission-success">
      <h2>Thank you!</h2>
      <p>Your form has been submitted successfully.</p>
      <p>You can now close this tab.</p>
    </div>
  } @else {
    <div class="form-not-found">
      <h2>Form not found</h2>
      <p>The form you are looking for could not be found or has expired.</p>
    </div>
  }
</div>
